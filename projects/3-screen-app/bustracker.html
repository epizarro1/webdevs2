<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>CTA Bus Tracker</title>
        <style>
          #main {padding: 20px;}
        </style>
    </head>
    <body>
        <!-- Uses a header that scrolls with the text, rather than staying locked at the top -->
        <div class="mdl-layout mdl-js-layout">
          <header class="mdl-layout__header mdl-layout__header--scroll">
            <div class="mdl-layout__header-row">
              <!-- Title -->
              <span class="mdl-layout-title">Ethan's 3 Screen App</span>
              <!-- Add spacer, to align navigation to the right -->
              <div class="mdl-layout-spacer"></div>
              <!-- Navigation -->
              <nav class="mdl-navigation">
                <a class="mdl-navigation__link" href="index.html">Home</a>
                <a class="mdl-navigation__link" href="articlesearch.html">Article Search</a>
                <a class="mdl-navigation__link" href="bustracker.html">CTA Bus Tracker</a>
              </nav>
            </div>
          </header>
          <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">Ethan's 3 Screen App</span>
            <nav class="mdl-navigation">
              <a class="mdl-navigation__link" href="index.html">Home</a>
              <a class="mdl-navigation__link" href="articlesearch.html">Article Search</a>
              <a class="mdl-navigation__link" href="bustracker.html">CTA Bus Tracker</a>
            </nav>
          </div>
          <main class="mdl-layout__content" id="main">
            <div class="page-content">
              <h3>CTA Bus Tracker</h3>
              <p>This page brings up predictions for the bus stops at the intersection of North Western Avenue and West Addison Street.</p>
              <!-- Raised button with ripple -->
              <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" onClick="window.location.reload();" value="Refresh Page">
                Refresh
              </button>
              <hr>
              <div class="mdl-card">
                <div class="mdl-card__title">
                  <h2 class="mdl-card__title-text">Northbound</h2>
                </div>
                <div class="mdl-card__supporting-text">
                  <p class="p" id="p1"></p>
                </div>
              </div>
              <hr>
              <div class="mdl-card">
                <div class="mdl-card__title">
                  <h2 class="mdl-card__title-text">Southbound</h2>
                </div>
                <div class="mdl-card__supporting-text">
                  <p class="p" id="p2"></p>
                </div>
              </div>
              <hr>
              <div class="mdl-card">
                <div class="mdl-card__title">
                  <h2 class="mdl-card__title-text">Eastbound</h2>
                </div>
                <div class="mdl-card__supporting-text">
                  <p class="p" id="p3"></p>
                </div>
              </div>
              <hr>
              <div class="mdl-card">
                <div class="mdl-card__title">
                  <h2 class="mdl-card__title-text">Westbound</h2>
                </div>
                <div class="mdl-card__supporting-text">
                  <p class="p" id="p4"></p>
                </div>
              </div>
            </div>
          </main>
        </div>
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script>
          $(document).ready(function() {
            $(".p").html("");
            $.ajax({
              url: "https://polar-garden-75406.herokuapp.com/apiPassThru.php",
              dataType: "json",
              method: "GET",
              data: {"apiEndpoint": "http://www.ctabustracker.com/bustime/api/v2/getpredictions",
                "key": "VP7Jg5tpX5SdMKRrsuEgS4WjY",
                "format": "json",
                "stpid": "8195,8417,12569,12527",
                "top": ""
              }
            }).done(function(data) {
              $.each(data["bustime-response"]["prd"], function(i, v) {
                var delay = v.dly;
                if (delay == false) {
                  delay = "No";
                } else {
                  delay = "Yes";
                }
                var html = "Stop Name: "
                + v.stpnm
                + "<br>Route: "
                + v.rt
                + "<br>Delayed: "
                + delay
                + "<br>Arrival Time: "
                + v.prdtm
                + "<br>Minutes Until Arrival: "
                + v.prdctdn
                + "<br><br>";
                if (v.rtdir == "Northbound") {
                  $("#p1").append(html);
                } else if (v.rtdir == "Southbound"){
                  $("#p2").append(html);
                } else if (v.rtdir == "Eastbound") {
                  $("#p3").append(html);
                } else {
                  $("#p4").append(html);
                }
              });
            });
          });
        </script>
    </body>
</html>