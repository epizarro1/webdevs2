<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>NYT Article Search</title>
        <style>
          .mdl-card {
            float: left;
            width: 150px;
          }
          #main {padding: 20px;}
        </style>
    </head>
    <body>
        <!-- Uses a header that scrolls with the text, rather than staying locked at the top -->
        <div class="mdl-layout mdl-js-layout">
          <header class="mdl-layout__header mdl-layout__header--scroll">
            <div class="mdl-layout__header-row">
              <!-- Title -->
              <span class="mdl-layout-title">Ethan's 3 Screen App</span>
              <!-- Add spacer, to align navigation to the right -->
              <div class="mdl-layout-spacer"></div>
              <!-- Navigation -->
              <nav class="mdl-navigation">
                <a class="mdl-navigation__link" href="index.html">Home</a>
                <a class="mdl-navigation__link" href="articlesearch.html">Article Search</a>
                <a class="mdl-navigation__link" href="bustracker.html">CTA Bus Tracker</a>
              </nav>
            </div>
          </header>
          <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">Ethan's 3 Screen App</span>
            <nav class="mdl-navigation">
              <a class="mdl-navigation__link" href="index.html">Home</a>
              <a class="mdl-navigation__link" href="articlesearch.html">Article Search</a>
              <a class="mdl-navigation__link" href="bustracker.html">CTA Bus Tracker</a>
            </nav>
          </div>
          <main class="mdl-layout__content" id="main">
            <div class="page-content">
                <h3>Search Articles</h3>
                <p>This is to search articles of the New York Times. Put a search term into the box to search their database for articles.</p>
                <!-- Expandable Textfield -->
                <zform>
                  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                    <input class="mdl-textfield__input" id="input" type="text">
                    <label class="mdl-textfield__label" for="input">Search</label>
                  </div><br>
                  <!-- Raised button with ripple -->
                  <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" id="search">
                      Search
                  </button>
                </zform>
                <hr>
                <div id="output"></div>
            </div>
          </main>
        </div>
        <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script>
            /* global $ */
            $(document).ready(function() {
                $("#search").click(function() {
                    // clear the output div
                    $("#output").html("");
                    // set the query to the input value
                    var query = $("#input").val();
                    // create the url with its parameters
                    var baseUrl = "https://api.nytimes.com/svc/search/v2/articlesearch.json";
                    var url = baseUrl += "?" + $.param({
                        "api-key": "f6bce4fb3a5349e18c7bf76f10e0d774",
                        "q": query,
                        "sort": "newest"
                    });
                    $.getJSON(url).done(function(data) {
                        console.log(data);
                        $.each(data.response.docs, function(index, value) {
                            var headline = value.headline.print_headline;
                            if (headline === undefined || headline === "") {
                                headline = value.headline.main;
                            }
                            var rawDate = value.pub_date;
                            var date = new Date(rawDate);
                            $("#output").append('<div class="mdl-card"><div class="mdl-card__title"><h2 class="mdl-card__title-text">'
                            + headline
                            + '</h2></div><div class="mdl-card__supporting-text"><p>Published '
                            + date
                            + '</p><p>Type: '
                            + value.type_of_material
                            + '</p><p>'
                            + value.snippet
                            + '</p></div></div>');
                        });
                    }).fail(function() {
                        $("#output").html("<p>An error has occured.</p>");
                    });
                });
            });
        </script>
    </body>
</html>